<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جامع العافية</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #57c5b6;
            --accent-color: #159895;
            --light-color: #f9f9f9;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --border-radius: 8px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            margin: 0;
            padding: 0;
            color: var(--dark-color);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://i.pinimg.com/originals/0e/0b/2c/0e0b2c0e4c8f8b8b8b8b8b8b8b8b8b8b.png') center/cover no-repeat;
            opacity: 0.1;
            z-index: 0;
        }
        
        .header h1 {
            position: relative;
            z-index: 1;
            font-size: 2.5rem;
            margin: 0;
            padding: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            position: relative;
            z-index: 1;
            font-size: 1.2rem;
            margin: 10px 0 0;
            opacity: 0.9;
        }
        
        .welcome-message {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.2rem;
            border-right: 5px solid var(--accent-color);
        }
        
        .auth-section {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-width: 500px;
            margin: 50px auto;
            text-align: center;
        }
        
        .auth-section h2 {
            color: var(--primary-color);
            margin-top: 0;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .tab.active {
            background-color: rgba(21, 152, 149, 0.1);
            color: var(--primary-color);
            border-bottom: 3px solid var(--accent-color);
            font-weight: 700;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        h2 {
            color: var(--primary-color);
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            font-size: 1.8rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            transition: border 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(21, 152, 149, 0.2);
        }
        
        .input-icon {
            position: relative;
        }
        
        .input-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-color);
        }
        
        .input-icon input {
            padding-right: 15px;
            padding-left: 40px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button i {
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background-color: #f1f1f1;
            color: var(--dark-color);
        }
        
        .btn-secondary:hover {
            background-color: #e1e1e1;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .search-container {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
        }
        
        .search-box input {
            flex: 1;
        }
        
        /* أنماط الجدول الأساسية */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    box-shadow: var(--box-shadow);
    border-radius: var(--border-radius);
    overflow: hidden;
}

/* التخصيص الجديد لعمود الصفحات */
#recordsTable td:nth-child(3) {
    direction: ltr;
    text-align: left;
    font-family: monospace;
    white-space: nowrap;
}
        
        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f1f1;
        }
        
        .actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .action-btn {
            padding: 6px 12px;
            font-size: 0.9rem;
            border-radius: 4px;
        }
        
        .edit-btn {
            background-color: var(--warning-color);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-excellent {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }
        
        .status-very-good {
            background-color: rgba(41, 128, 185, 0.2);
            color: #2980b9;
        }
        
        .status-good {
            background-color: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }
        
        .page-btn {
            padding: 8px 15px;
            background-color: #f1f1f1;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .page-btn.active {
            background-color: var(--accent-color);
            color: white;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: var(--danger-color);
            color: white;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }
        
        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }
        
        .admin-only {
            display: none;
        }
        
        .admin-section {
            border: 2px solid #1a5f7a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
        }
        
        .export-btn {
            background-color: #6c757d;
            color: white;
        }
        
        .export-btn:hover {
            background-color: #5a6268;
        }
        
        .student-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-right: 4px solid var(--accent-color);
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .export-group-btn {
            background-color: #6c757d;
            color: white;
        }
        
        .settings-section {
            margin-bottom: 30px;
        }
        /* أنماط صفحة الطالب */
.student-profile {
    background: white;
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--box-shadow);
    margin-bottom: 30px;
}

.student-info {
    background: #f8f9fa;
    padding: 15px;
    border-radius: var(--border-radius);
    margin-bottom: 20px;
    border-right: 4px solid var(--accent-color);
}

.btn-view {
    background: var(--accent-color);
    color: white;
    padding: 8px 15px;
    border-radius: var(--border-radius);
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s ease;
}

.btn-view:hover {
    background: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.memorization-records {
    margin-top: 20px;
}

.memorization-records table {
    width: 100%;
    margin-top: 15px;
}
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tab {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .logout-btn, .user-info {
                position: static;
                margin: 10px 0;
                display: inline-block;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="auth-container">
        <div class="header">
            <h1>جامع العافية</h1>
            <p>نظام متابعة حفظ القرآن الكريم وتقييم الطلاب</p>
        </div>
        
        <div class="auth-section" id="login-section">
            <h2><i class="fas fa-sign-in-alt"></i> تسجيل الدخول</h2>
            <div class="form-group">
                <label for="login-type">نوع المستخدم:</label>
                <select id="login-type" class="form-control" onchange="toggleLoginFields()">
                    <option value="student">طالب</option>
                    <option value="admin">مشرف</option>
                </select>
            </div>
            
            <div class="form-group" id="student-id-group">
                <label for="student-id">رقم الطالب:</label>
                <div class="input-icon">
                    <i class="fas fa-id-card"></i>
                    <input type="text" id="student-id" placeholder="أدخل رقم الطالب">
                </div>
            </div>
            
            <div class="form-group" id="admin-username-group" style="display: none;">
                <label for="admin-username">اسم المستخدم:</label>
                <div class="input-icon">
                    <i class="fas fa-user"></i>
                    <input type="text" id="admin-username" placeholder="أدخل اسم المستخدم">
                </div>
            </div>
            
            <div class="form-group" id="admin-password-group" style="display: none;">
                <label for="admin-password">كلمة المرور:</label>
                <div class="input-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="admin-password" placeholder="أدخل كلمة المرور">
                </div>
            </div>
            
            <button class="btn-primary" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> دخول
            </button>
        </div>
    </div>
    
    <div class="container" id="app-container" style="display: none;">
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
        </button>
        
        <div class="user-info" id="user-info">
            <i class="fas fa-user"></i> <span id="username-display"></span>
        </div>
        
        <div class="header">
            <h1>جامع العافية</h1>
            <p>نظام متابعة حفظ القرآن الكريم وتقييم الطلاب</p>
        </div>
        
        <!-- رسالة الترحيب القابلة للتعديل -->
        <div class="welcome-message" id="welcome-message">
            <i class="fas fa-quote-right"></i>
            <span id="welcome-text">مرحباً بكم في نظام جامع العافية لمتابعة حفظ القرآن الكريم</span>
            <i class="fas fa-quote-left"></i>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('records-tab')">
                <i class="fas fa-list"></i> سجلات الحفظ
            </div>
            <div id="admin-tab" class="tab" onclick="showTab('entry-tab')" style="display: none;">
                <i class="fas fa-plus-circle"></i> إدخال بيانات
            </div>
            <div id="management-tab" class="tab" onclick="showTab('management-tab')" style="display: none;">
                <i class="fas fa-cog"></i> الإدارة
            </div>
        </div>
        
        <!-- تبويب إدخال البيانات (للمشرفين فقط) -->
        <div id="entry-tab" class="tab-content">
            <h2><i class="fas fa-book-open"></i> تسجيل صفحة جديدة</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="studentId">رقم الطالب:</label>
                    <div class="input-icon">
                        <i class="fas fa-id-card"></i>
                        <input type="text" id="studentId" placeholder="أدخل رقم الطالب" onchange="loadStudentName()" onkeyup="loadStudentName()">
                    </div>
                </div>
                
                <div class="student-info" id="student-info" style="display: none;">
                                    <h4>بيانات الطالب:</h4>
                <p><strong>الاسم:</strong> <span id="display-student-name"></span></p>
                <p><strong>المجموعة:</strong> <span id="display-student-group"></span></p>
            </div>
            
            <input type="hidden" id="studentName">
            
            <div class="form-group">
                <label for="pageNumber">رقم الصفحة:</label>
                <div class="input-icon">
                    <i class="fas fa-quran"></i>
                    <input type="number" id="pageNumber" min="1" max="604" placeholder="من 1 إلى 604">
                </div>
            </div>
            
            <div class="form-group">
                <label for="evaluation">تقييم الحفظ:</label>
                <div class="input-icon">
                    <i class="fas fa-star"></i>
                    <select id="evaluation">
                        <option value="">اختر التقييم</option>
                        <option value="ممتاز">ممتاز</option>
                        <option value="جيد جداً">جيد جداً</option>
                        <option value="جيد">جيد</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="date">تاريخ الحفظ:</label>
                <div class="input-icon">
                    <i class="fas fa-calendar-alt"></i>
                    <input type="date" id="date">
                </div>
            </div>
            
            <div class="form-group">
                <label for="notes">ملاحظات:</label>
                <textarea id="notes" rows="2" placeholder="أي ملاحظات إضافية"></textarea>
            </div>
        </div>
        
        <div class="buttons">
            <button class="btn-secondary" onclick="clearForm()">
                <i class="fas fa-eraser"></i> مسح النموذج
            </button>
            <button class="btn-primary" onclick="saveRecord()">
                <i class="fas fa-save"></i> حفظ البيانات
            </button>
        </div>
    </div>
    
    <!-- تبويب سجلات الحفظ -->
    <div id="records-tab" class="tab-content active">
        <h2><i class="fas fa-list-ol"></i> سجلات الحفظ</h2>
        
        <!-- خانة بحث خاصة بالطلاب -->
        <div class="search-container" id="student-search-container" style="display: none;">
            <div class="input-icon">
                <i class="fas fa-search"></i>
                <input type="text" id="student-search-input" placeholder="ابحث برقم الطالب..." disabled>
            </div>
        </div>
        
        <!-- خانة بحث للمشرفين -->
        <div class="search-container" id="admin-search-container">
            <div class="search-box">
                <input type="text" id="search" placeholder="ابحث باسم الطالب، رقم الطالب أو رقم الصفحة...">
                <button class="btn-primary" onclick="searchRecords()">
                    <i class="fas fa-search"></i> بحث
                </button>
                <button class="btn-secondary" onclick="resetSearch()">
                    <i class="fas fa-redo"></i> إعادة تعيين
                </button>
            </div>
        </div>
        
        <table id="recordsTable">
            <thead>
                <tr>
                    <th>صفحة الطالب</th>
                    <th>رقم الطالب</th>
                    <th>اسم الطالب</th>
                    <th>الصفحات المحفوظة</th>
                    <td><button onclick="exportStudentData('${studentId}')">تصدير</button></td>
                    <th id="actions-header">الإجراءات</th>
                </tr>
            </thead>
            <tbody>
                <td>
  <a href="student_page.html?id=${student.id}" class="btn-view">
    <i class="fas fa-user"></i> صفحة الطالب
  </a>
</td>
                <!-- سيتم ملء البيانات هنا عبر الجافاسكريبت -->
            </tbody>
        </table>
        
        <div class="pagination">
            <button class="page-btn"><i class="fas fa-angle-double-right"></i></button>
            <button class="page-btn active">1</button>
            <button class="page-btn">2</button>
            <button class="page-btn">3</button>
            <button class="page-btn"><i class="fas fa-angle-double-left"></i></button>
        </div>
    </div>
    
    <!-- تبويب الإدارة (للمالك والمشرفين) -->
    <div id="management-tab" class="tab-content admin-only">
        <!-- قسم إعدادات النظام -->
        <div id="system-settings" class="admin-section settings-section">
            <h2><i class="fas fa-cogs"></i> إعدادات النظام</h2>
            <div class="form-group">
                <label for="welcome-message-input">رسالة الترحيب:</label>
                <textarea id="welcome-message-input" rows="3" placeholder="أدخل رسالة الترحيب التي تظهر في الصفحة الرئيسية"></textarea>
            </div>
            <button class="btn-primary" onclick="saveSettings()">
                <i class="fas fa-save"></i> حفظ الإعدادات
            </button>
        </div>

        <!-- قسم إدارة المشرفين (يظهر فقط للمالك) -->
        <div id="admin-management" class="admin-section">
            <h2><i class="fas fa-user-shield"></i> إدارة المشرفين</h2>
            <div class="form-group">
                <label for="new-admin-username">اسم المستخدم الجديد:</label>
                <input type="text" id="new-admin-username" placeholder="اسم المستخدم للمشرف الجديد">
            </div>
            <div class="form-group">
                <label for="new-admin-password">كلمة المرور:</label>
                <input type="password" id="new-admin-password" placeholder="كلمة مرور المشرف الجديد">
            </div>
            <button class="btn-primary" onclick="addAdmin()">
                <i class="fas fa-plus"></i> إضافة مشرف
            </button>

            <h3 style="margin-top: 20px;">قائمة المشرفين</h3>
            <table id="admins-table">
                <thead>
                    <tr>
                        <th>اسم المستخدم</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- قسم إدارة الطلاب -->
        <div id="students-management" class="admin-section">
            <h2><i class="fas fa-users"></i> إدارة الطلاب</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="new-student-id">رقم الطالب:</label>
                    <input type="text" id="new-student-id" placeholder="أدخل رقم الطالب">
                </div>
                <div class="form-group">
                    <label for="new-student-name">اسم الطالب:</label>
                    <input type="text" id="new-student-name" placeholder="أدخل اسم الطالب">
                </div>
                <div class="form-group">
                    <label for="new-student-group">المجموعة:</label>
                    <input type="text" id="new-student-group" placeholder="أدخل المجموعة">
                </div>
            </div>
            <button class="btn-primary" onclick="addStudent()">
                <i class="fas fa-user-plus"></i> إضافة طالب
            </button>

            <div class="export-options">
                <button class="btn-primary" onclick="exportAllStudents()">
                    <i class="fas fa-download"></i> تصدير جميع الطلاب
                </button>
                <button class="export-group-btn" onclick="exportSelectedStudents()">
                    <i class="fas fa-download"></i> تصدير المحددين
                </button>
            </div>

            <div class="search-container" style="margin-top: 20px;">
                <input type="text" id="student-search" placeholder="ابحث عن طالب...">
                <button class="btn-primary" onclick="searchStudents()">
                    <i class="fas fa-search"></i> بحث
                </button>
            </div>

            <table id="students-table">
                <thead>
                    <tr>
                        <th>صفحة الطالب</th>
                        <th>تحديد</th>
                        <th>رقم الطالب</th>
                        <th>اسم الطالب</th>
                        <th>المجموعة</th>
                        <th>عدد الصفحات المحفوظة</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    <td>
  <a href="student_page.html?id=${student.id}" class="btn-view">
    <i class="fas fa-user"></i> صفحة الطالب
  </a>
</td>
                </tbody>
            </table>
        </div>

        <!-- قسم تغيير كلمة المرور -->
        <div id="change-password-section" class="admin-section">
            <h2><i class="fas fa-key"></i> تغيير كلمة المرور</h2>
            <div class="form-group">
                <label for="current-password">كلمة المرور الحالية:</label>
                <input type="password" id="current-password" placeholder="أدخل كلمة المرور الحالية">
            </div>
            <div class="form-group">
                <label for="new-password">كلمة المرور الجديدة:</label>
                <input type="password" id="new-password" placeholder="أدخل كلمة المرور الجديدة">
            </div>
            <div class="form-group">
                <label for="confirm-password">تأكيد كلمة المرور:</label>
                <input type="password" id="confirm-password" placeholder="أكد كلمة المرور الجديدة">
            </div>
            <button class="btn-primary" onclick="changePassword()">
                <i class="fas fa-save"></i> حفظ التغييرات
            </button>
        </div>
    </div>
</div>

<script>
    // متغيرات النظام
    let currentUser = null;
    let isOwner = false;
    let isAdmin = false;
    const APP_KEY = 'jame3alafia_system_v3';
    
    // تهيئة النظام
    function initSystem() {
        // جلب بيانات النظام من localStorage
        if (!localStorage.getItem(APP_KEY)) {
            // إنشاء بيانات أولية إذا لم توجد
            const initialData = {
                owner: {
                    username: 'admin',
                    password: 'admin123' // يجب تغييرها بعد التسجيل الأول
                },
                admins: [],
                students: [],
                records: [],
                settings: {
                    welcomeMessage: 'مرحباً بكم في نظام جامع العافية لمتابعة حفظ القرآن الكريم'
                }
            };
            localStorage.setItem(APP_KEY, JSON.stringify(initialData));
        }
        
        // تحميل رسالة الترحيب
        const systemData = JSON.parse(localStorage.getItem(APP_KEY));
        if (systemData.settings && systemData.settings.welcomeMessage) {
            document.getElementById('welcome-text').textContent = systemData.settings.welcomeMessage;
        }
        
        // التحقق من تسجيل الدخول في الجلسة الحالية
        const sessionUser = sessionStorage.getItem('currentUser');
        if (sessionUser) {
            currentUser = JSON.parse(sessionUser);
            isOwner = currentUser.isOwner || false;
            isAdmin = currentUser.isAdmin || false;
            
            if (currentUser.isStudent) {
                showStudentApp();
            } else {
                showApp();
            }
        }
    }
    
    // تبديل حقول تسجيل الدخول حسب نوع المستخدم
    function toggleLoginFields() {
        const loginType = document.getElementById('login-type').value;
        
        if (loginType === 'admin') {
            document.getElementById('student-id-group').style.display = 'none';
            document.getElementById('admin-username-group').style.display = 'block';
            document.getElementById('admin-password-group').style.display = 'block';
        } else {
            document.getElementById('student-id-group').style.display = 'block';
            document.getElementById('admin-username-group').style.display = 'none';
            document.getElementById('admin-password-group').style.display = 'none';
        }
    }
    
    // وظيفة تسجيل الدخول
    function login() {
        const loginType = document.getElementById('login-type').value;
        const systemData = JSON.parse(localStorage.getItem(APP_KEY));
        
        if (loginType === 'admin') {
            // تسجيل دخول مشرف أو مالك
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            if (!username || !password) {
                alert('الرجاء إدخال اسم المستخدم وكلمة المرور');
                return;
            }
            
            if (username === systemData.owner.username && password === systemData.owner.password) {
                currentUser = { 
                    username, 
                    isOwner: true,
                    isAdmin: true 
                };
                isOwner = true;
                isAdmin = true;
                
                // حفظ حالة الجلسة
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                showApp();
                return;
            }
            
            // التحقق من المشرفين
            const admin = systemData.admins.find(a => a.username === username && a.password === password);
            if (admin) {
                currentUser = { 
                    username, 
                    isOwner: false,
                    isAdmin: true 
                };
                isOwner = false;
                isAdmin = true;
                
                // حفظ حالة الجلسة
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                showApp();
                return;
            }
            
            alert('اسم المستخدم أو كلمة المرور غير صحيحة');
        } else {
            // تسجيل دخول طالب
            const studentId = document.getElementById('student-id').value;
            
            if (!studentId) {
                alert('الرجاء إدخال رقم الطالب');
                return;
            }
            
            const student = systemData.students.find(s => s.id === studentId);
            
            if (student) {
                currentUser = { 
                    username: student.name, 
                    isStudent: true, 
                    studentId: student.id 
                };
                
                // حفظ حالة الجلسة
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                showStudentApp();
                return;
            }
            
            alert('رقم الطالب غير مسجل في النظام');
        }
    }
    
    // عرض واجهة المشرف/المالك
    function showApp() {
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('app-container').style.display = 'block';
        document.getElementById('username-display').textContent = currentUser.username;
        
        // إظهار أقسام المالك فقط إذا كان مالكاً
        if (isOwner) {
            document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
            document.getElementById('management-tab').style.display = 'block';
            loadAdmins();
        } else if (isAdmin) {
            document.getElementById('admin-tab').style.display = 'block';
            document.getElementById('management-tab').style.display = 'block';
            document.getElementById('admin-management').style.display = 'none';
        }
        
        // إعداد واجهة البحث
        document.getElementById('student-search-container').style.display = 'none';
        
        
        loadStudents();
        displayRecords();
    }
    
    function displayRecords(filteredRecords = null) {
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const tableBody = document.querySelector('#recordsTable tbody');
    tableBody.innerHTML = '';
    
    const recordsToDisplay = filteredRecords || systemData.records;
    
    if (recordsToDisplay.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="3" class="empty-state">
                    <i class="fas fa-book-open"></i>
                    <p>لا توجد سجلات مسجلة بعد</p>
                </td>
            </tr>
        `;
        return;
    }

    // تجميع الصفحات حسب الطالب مع الترتيب
    const studentsRecords = {};
    recordsToDisplay.forEach(record => {
        if (!studentsRecords[record.studentId]) {
            studentsRecords[record.studentId] = {
                name: record.studentName,
                pages: []
            };
        }
        studentsRecords[record.studentId].pages.push(parseInt(record.pageNumber));
    });

    // عرض البيانات المجمعة مع الترتيب
    for (const studentId in studentsRecords) {
        const student = studentsRecords[studentId];
        student.pages.sort((a, b) => a - b); // ترتيب الصفحات تصاعدياً
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${studentId}</td>
            <td>${student.name}</td>
            <td>${student.pages.join('، ')}</td>
        `;
        tableBody.appendChild(row);
    }
}
        
        // إخفاء أقسام الإدارة
        document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
        document.getElementById('entry-tab').style.display = 'none';
        document.getElementById('management-tab').style.display = 'none';
        document.getElementById('admin-tab').style.display = 'none';
        
        // إعداد واجهة البحث
        document.getElementById('student-search-container').style.display = 'block';
        document.getElementById('admin-search-container').style.display = 'none';
        document.getElementById('student-search-input').value = currentUser.studentId;
        document.getElementById('student-search-input').disabled = true;
        document.getElementById('actions-header').style.display = 'none';
        
        // عرض سجلات الطالب فقط
        displayStudentRecords(currentUser.studentId);
    }
    
    // تسجيل الخروج
    function logout() {
        currentUser = null;
        isOwner = false;
        isAdmin = false;
        sessionStorage.removeItem('currentUser');
        
        document.getElementById('app-container').style.display = 'none';
        document.getElementById('auth-container').style.display = 'block';
        
        // إعادة تعيين حقول تسجيل الدخول
        document.getElementById('login-type').value = 'student';
        document.getElementById('student-id').value = '';
        document.getElementById('admin-username').value = '';
        document.getElementById('admin-password').value = '';
        toggleLoginFields();
    }
    
    // عرض تبويب معين
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.getElementById(tabId).style.display = 'block';
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        
        // تحديث البيانات عند عرض التبويب
        if (tabId === 'records-tab') {
            if (currentUser.isStudent) {
                displayStudentRecords(currentUser.studentId);
            } else {
                displayRecords();
            }
        } else if (tabId === 'management-tab') {
            if (isOwner) {
                loadAdmins();
                loadSettings();
            }
            loadStudents();
        }
    }
    
    // تحميل اسم الطالب عند إدخال رقمه
    function loadStudentName() {
        const studentId = document.getElementById('studentId').value;
        if (!studentId) {
                    document.getElementById('studentName').value = '';
        return;
    }
    
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const student = systemData.students.find(s => s.id === studentId);
    
    if (student) {
        document.getElementById('student-info').style.display = 'block';
        document.getElementById('display-student-name').textContent = student.name;
        document.getElementById('display-student-group').textContent = student.group || 'غير محدد';
        document.getElementById('studentName').value = student.name;
    } else {
        document.getElementById('student-info').style.display = 'none';
        document.getElementById('studentName').value = '';
        
        if (confirm('رقم الطالب غير مسجل. هل تريد إضافة هذا الطالب جديد؟')) {
            const name = prompt('أدخل اسم الطالب:');
            if (name) {
                const group = prompt('أدخل المجموعة (اختياري):') || '';
                systemData.students.push({
                    id: studentId,
                    name: name,
                    group: group
                });
                localStorage.setItem(APP_KEY, JSON.stringify(systemData));
                loadStudentName(); // إعادة تحميل البيانات بعد الإضافة
            }
        }
    }
}

// حفظ السجل الجديد
function saveRecord() {
    const studentId = document.getElementById('studentId').value;
    const studentName = document.getElementById('studentName').value;
    const pageNumber = document.getElementById('pageNumber').value;
    const evaluation = document.getElementById('evaluation').value;
    const date = document.getElementById('date').value;
    const notes = document.getElementById('notes').value;
    
    if (!studentId || !pageNumber || !evaluation || !date) {
        alert('الرجاء ملء جميع الحقول المطلوبة');
        return;
    }
    
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    
    // إضافة السجل الجديد
    const record = {
        id: Date.now(),
        studentId,
        studentName,
        pageNumber,
        evaluation,
        date,
        notes,
        addedBy: currentUser.username,
        addedAt: new Date().toISOString()
    };
    
    systemData.records.push(record);
    localStorage.setItem(APP_KEY, JSON.stringify(systemData));
    
    alert('تم حفظ السجل بنجاح');
    clearForm();
    displayRecords();
}

// مسح النموذج
function clearForm() {
    document.getElementById('studentId').value = '';
    document.getElementById('studentName').value = '';
    document.getElementById('pageNumber').value = '';
    document.getElementById('evaluation').value = '';
    document.getElementById('date').value = '';
    document.getElementById('notes').value = '';
    document.getElementById('student-info').style.display = 'none';
}

// عرض السجلات
function displayRecords(filteredRecords = null) {
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const tableBody = document.querySelector('#recordsTable tbody');
    tableBody.innerHTML = '';
    
    const recordsToDisplay = filteredRecords || systemData.records;
    
    if (recordsToDisplay.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="7" class="empty-state">
                    <i class="fas fa-book-open"></i>
                    <p>لا توجد سجلات مسجلة بعد</p>
                </td>
            </tr>
        `;
        return;
    }
    
    // ترتيب السجلات من الأحدث إلى الأقدم
    const sortedRecords = [...recordsToDisplay].sort((a, b) => new Date(b.date) - new Date(a.date));
    
    sortedRecords.forEach(record => {
        let evaluationBadge = '';
        if (record.evaluation === 'ممتاز') {
            evaluationBadge = `<span class="status-badge status-excellent">ممتاز</span>`;
        } else if (record.evaluation === 'جيد جداً') {
            evaluationBadge = `<span class="status-badge status-very-good">جيد جداً</span>`;
        } else if (record.evaluation === 'جيد') {
            evaluationBadge = `<span class="status-badge status-good">جيد</span>`;
        }
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${record.studentId}</td>
            <td>${record.studentName}</td>
            <td>${record.pageNumber}</td>
            <td class="actions">
                ${isAdmin || isOwner ? `
                <button class="btn-danger action-btn" onclick="deleteRecord(${record.id})">
                    <i class="fas fa-trash"></i> حذف
                </button>
                ` : ''}
            </td>
        `;
        tableBody.appendChild(row);
    });
}

// عرض سجلات طالب معين
function displayStudentRecords(studentId) {
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const studentRecords = systemData.records.filter(r => r.studentId === studentId);
    displayRecords(studentRecords);
}

// البحث في السجلات
function searchRecords() {
    const searchTerm = document.getElementById('search').value.toLowerCase();
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    
    const filteredRecords = systemData.records.filter(record => 
        record.studentId.includes(searchTerm) ||
        record.studentName.toLowerCase().includes(searchTerm) ||
        record.pageNumber.toString().includes(searchTerm) ||
        record.evaluation.toLowerCase().includes(searchTerm)
    );
    
    displayRecords(filteredRecords);
}

// إعادة تعيين البحث
function resetSearch() {
    document.getElementById('search').value = '';
    displayRecords();
}

// حذف سجل
function deleteRecord(recordId) {
    if (!confirm('هل أنت متأكد من حذف هذا السجل؟')) return;
    
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    systemData.records = systemData.records.filter(r => r.id !== recordId);
    localStorage.setItem(APP_KEY, JSON.stringify(systemData));
    
    displayRecords();
    alert('تم حذف السجل بنجاح');
}

// إضافة مشرف جديد
function addAdmin() {
    if (!isOwner) return;
    
    const username = document.getElementById('new-admin-username').value;
    const password = document.getElementById('new-admin-password').value;
    
    if (!username || !password) {
        alert('الرجاء إدخال اسم المستخدم وكلمة المرور');
        return;
    }
    
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    
    // التحقق من عدم وجود مستخدم بنفس الاسم
    if (systemData.admins.some(a => a.username === username)) {
        alert('اسم المستخدم موجود بالفعل');
        return;
    }
    
    systemData.admins.push({ username, password });
    localStorage.setItem(APP_KEY, JSON.stringify(systemData));
    
    alert('تمت إضافة المشرف بنجاح');
    loadAdmins();
    
    // مسح الحقول
    document.getElementById('new-admin-username').value = '';
    document.getElementById('new-admin-password').value = '';
}

// حذف مشرف
function removeAdmin(username) {
    if (!isOwner) return;
    
    if (!confirm('هل أنت متأكد من حذف هذا المشرف؟')) return;
    
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    systemData.admins = systemData.admins.filter(a => a.username !== username);
    localStorage.setItem(APP_KEY, JSON.stringify(systemData));
    
    loadAdmins();
    alert('تم حذف المشرف بنجاح');
}

// تحميل قائمة المشرفين
function loadAdmins() {
    if (!isOwner) return;
    
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const tableBody = document.querySelector('#admins-table tbody');
    tableBody.innerHTML = '';
    
    systemData.admins.forEach(admin => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${admin.username}</td>
            <td class="actions">
                <button class="btn-danger action-btn" onclick="removeAdmin('${admin.username}')">
                    <i class="fas fa-trash"></i> حذف
                </button>
            </td>
        `;
        tableBody.appendChild(row);
    });
}

// إضافة طالب جديد
function addStudent() {
    const id = document.getElementById('new-student-id').value;
    const name = document.getElementById('new-student-name').value;
    const group = document.getElementById('new-student-group').value;
    
    if (!id || !name) {
        alert('الرجاء إدخال رقم الطالب والاسم');
        return;
    }
    
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    
    // التحقق من عدم وجود طالب بنفس الرقم
    if (systemData.students.some(s => s.id === id)) {
        alert('رقم الطالب موجود بالفعل');
        return;
    }
    
    systemData.students.push({ id, name, group });
    localStorage.setItem(APP_KEY, JSON.stringify(systemData));
    
    alert('تمت إضافة الطالب بنجاح');
    loadStudents();
    
    // مسح الحقول
    document.getElementById('new-student-id').value = '';
    document.getElementById('new-student-name').value = '';
    document.getElementById('new-student-group').value = '';
}


// تحميل قائمة الطلاب
function loadStudents() {
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const tableBody = document.querySelector('#students-table tbody');
    tableBody.innerHTML = '';
    
    systemData.students.forEach(student => {
        const pagesCount = systemData.records.filter(r => r.studentId === student.id).length;
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="checkbox" class="student-checkbox" value="${student.id}"></td>
            <td>${student.id}</td>
            <td>${student.name}</td>
            <td>${student.group || '-'}</td>
            <td>${pagesCount}</td>
            <td class="actions">
                <button class="btn-primary action-btn" onclick="exportStudentData('${student.id}')">
                    <i class="fas fa-download"></i> تصدير
                </button>
                ${isOwner ? `
                <button class="btn-danger action-btn" onclick="removeStudent('${student.id}')">
                    <i class="fas fa-trash"></i> حذف
                </button>
                ` : ''}
            </td>
        `;
        tableBody.appendChild(row);
    });
}

// البحث عن الطلاب
function searchStudents() {
    const searchTerm = document.getElementById('student-search').value.toLowerCase();
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const tableBody = document.querySelector('#students-table tbody');
    tableBody.innerHTML = '';
    
    const filteredStudents = systemData.students.filter(student => 
        student.id.includes(searchTerm) ||
        student.name.toLowerCase().includes(searchTerm) ||
        (student.group && student.group.toLowerCase().includes(searchTerm))
    );
    
    if (filteredStudents.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="6" class="empty-state">
                    <i class="fas fa-search"></i>
                    <p>لا توجد نتائج مطابقة للبحث</p>
                </td>
            </tr>
        `;
        return;
    }
    
    filteredStudents.forEach(student => {
        const pagesCount = systemData.records.filter(r => r.studentId === student.id).length;
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="checkbox" class="student-checkbox" value="${student.id}"></td>
            <td>${student.id}</td>
            <td>${student.name}</td>
            <td>${student.group || '-'}</td>
            <td>${pagesCount}</td>
            <td class="actions">
                <button class="btn-primary action-btn" onclick="openStudentPage('${student.id}')">
                    <i class="fas fa-download"></i> تصدير
                </button>
                ${isOwner ? `
                <button class="btn-danger action-btn" onclick="removeStudent('${student.id}')">
                    <i class="fas fa-trash"></i> حذف
                </button>
                ` : ''}
            </td>
        `;
        tableBody.appendChild(row);
    });
}

// تصدير بيانات طالب واحد
function exportStudentData(studentId) {
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const student = systemData.students.find(s => s.id === studentId);
    if (!student) return;

    // ترتيب السجلات حسب رقم الصفحة تصاعدياً
    const studentRecords = systemData.records
        .filter(r => r.studentId === studentId)
        .sort((a, b) => a.pageNumber - b.pageNumber);

    // تنسيق CSV مع إضافة رأس الملف
    let csvContent = "data:text/csv;charset=utf-8,";
    csvContent += `اسم الطالب,${student.name}\n`;
    csvContent += `رقم الطالب,${student.id}\n`;
    csvContent += `المجموعة,${student.group || 'غير محدد'}\n\n`;

    // عناوين الأعمدة
    csvContent += "رقم الصفحة,التقييم,التاريخ,الملاحظات\n";

    // بيانات السجلات (مرتبة ومهيأة للتصدير)
    studentRecords.forEach(record => {
        csvContent += [
            record.pageNumber,
            record.evaluation,
            record.date,
            `"${record.notes || ''}"` // وضع الملاحظات بين "" لتجنب مشاكل الفواصل
        ].join(',') + '\n';
    });

    // تنزيل الملف
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `سجل_حفظ_${student.name}_${student.id}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// تصدير جميع الطلاب
function exportAllStudents() {
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    exportStudentsData(systemData.students);
}

// تصدير الطلاب المحددين
function exportSelectedStudents() {
    const checkboxes = document.querySelectorAll('.student-checkbox:checked');
    if (checkboxes.length === 0) {
        alert('لم يتم تحديد أي طلاب');
        return;
    }
    
    const selectedIds = Array.from(checkboxes).map(cb => cb.value);
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    const selectedStudents = systemData.students.filter(s => selectedIds.includes(s.id));
    
    exportStudentsData(selectedStudents);
}

// تصدير بيانات مجموعة طلاب
function exportStudentsData(students) {
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    
    let csvContent = "data:text/csv;charset=utf-8,";
    
    // عنوان الملف
    csvContent += `سجل حفظ الطلاب - ${new Date().toLocaleDateString()}\n\n`;
    
    students.forEach(student => {
        const studentRecords = systemData.records.filter(r => r.studentId === student.id);
        
        if (studentRecords.length > 0) {
            // بيانات الطالب
            csvContent += `الطالب: ${student.name}\n`;
            csvContent += `رقم الطالب: ${student.id}\n`;
            csvContent += `المجموعة: ${student.group || 'غير محدد'}\n`;
            csvContent += `عدد الصفحات المحفوظة: ${studentRecords.length}\n\n`;
            
            // عناوين الأعمدة
            csvContent += "رقم الصفحة,التقييم,التاريخ,الملاحظات\n";
            
            // بيانات السجلات
            studentRecords.forEach(record => {
                csvContent += `${record.pageNumber},${record.evaluation},${record.date},${record.notes || ''}\n`;
            });
            
            csvContent += "\n\n";
        }
    });
    
    // إنشاء الرابط وتنزيل الملف
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `سجل_حفظ_الطلاب_${new Date().toISOString().split('T')[0]}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// تحميل الإعدادات
function loadSettings() {
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    if (systemData.settings) {
        document.getElementById('welcome-message-input').value = systemData.settings.welcomeMessage || '';
    }
}

// حفظ الإعدادات
function saveSettings() {
    const welcomeMessage = document.getElementById('welcome-message-input').value;
    
    const systemData = JSON.parse(localStorage.getItem(APP_KEY));
    
    if (!systemData.settings) {
        systemData.settings = {};
    }
    
    systemData.settings.welcomeMessage = welcomeMessage;
    localStorage.setItem(APP_KEY, JSON.stringify(systemData));
    
                // تحديث رسالة الترحيب مباشرة
            document.getElementById('welcome-text').textContent = welcomeMessage;
            alert('تم حفظ الإعدادات بنجاح');
        }
        
        // تغيير كلمة المرور
        function changePassword() {
            if (!currentUser) return;
            
            const currentPass = document.getElementById('current-password').value;
            const newPass = document.getElementById('new-password').value;
            const confirmPass = document.getElementById('confirm-password').value;
            
            if (!currentPass || !newPass || !confirmPass) {
                alert('الرجاء إدخال جميع الحقول');
                return;
            }
            
            if (newPass !== confirmPass) {
                alert('كلمة المرور الجديدة غير متطابقة');
                return;
            }
            
            const systemData = JSON.parse(localStorage.getItem(APP_KEY));
            
            if (isOwner) {
                if (currentPass !== systemData.owner.password) {
                    alert('كلمة المرور الحالية غير صحيحة');
                    return;
                }
                
                systemData.owner.password = newPass;
            } else {
                // تغيير كلمة مرور مشرف
                const adminIndex = systemData.admins.findIndex(a => a.username === currentUser.username);
                if (adminIndex === -1 || systemData.admins[adminIndex].password !== currentPass) {
                    alert('كلمة المرور الحالية غير صحيحة');
                    return;
                }
                
                systemData.admins[adminIndex].password = newPass;
            }
            
            localStorage.setItem(APP_KEY, JSON.stringify(systemData));
            
            // مسح الحقول
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            
            alert('تم تغيير كلمة المرور بنجاح');
        }
        // دالة لفتح صفحة الطالب
function openStudentPage(studentId) {
    // إنشاء رابط صفحة الطالب مع معلمة ID
    window.location.href = `student_page.html?id=${studentId}`;
}
        // عند تحميل الصفحة
        window.onload = function() {
            initSystem();
            toggleLoginFields();
            
            // إضافة مستخدم مالك إذا لم يكن موجوداً
            const systemData = JSON.parse(localStorage.getItem(APP_KEY));
            if (!systemData.owner) {
                systemData.owner = {
                    username: 'admin',
                    password: 'admin123' // يجب تغييرها بعد التسجيل الأول
                };
                localStorage.setItem(APP_KEY, JSON.stringify(systemData));
            }
        };
    </script>
</body>
</html>
